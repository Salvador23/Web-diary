<!-- markdownlint-disable -->
### 发布-订阅模式
> 发布-订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。<br/>
> 优点：在异步函数完成更松耦合代码编写，一为时间上的解耦，二为对象之间的解耦。<br/>
> 缺点：创建订阅者本身要消耗一定的时间和内存。<br/>

#### 1. 实现通用发布-订阅事件：

```js
//所以我们把发布—订阅的功能提取出来，放在一个单独的对象内：
const event = {
  clientList: [],
  listen: function(key, fn){
    if(!this.clientList[key]){  // 如果还没有订阅过此类消息，给该类消息创建一个缓存列表
      this.clientList[key] = [] //空数组
    }
    this.clientList[key].push( fn ) // 订阅的消息添加进消息缓存列表
  },
  //发布消息方法: 
  trigger: function(){
    let key = Array.prototype.shift.call( arguments ) //为了从中取出消息类型
    let fns = this.clientList[key]; // 取出该消息对应的回调函数集合
  
    if(!fns || fns.length === 0){  //没有订阅该消息，则返回false
      return false;
    }
    for(let i = 0, fn; fn = fns[ i++ ];){
      fn.apply( this, arguments )
    }
  },
  // 删除消息方法:
  remove: function(key ,fn){
    let fns = this.clientList[ key ];
    if(!fns){ //如果key对应消息没有被人订阅，则返回false;
      return false;
    }
    if(!fn){
      fns && (fns.length == 0);
    }else{
      for(let l = fns.length-1; l>=0; l--){
        let _fn = fns[ l ];
        if(_fn === fn){
          fns.splice(l, 1); //删除订阅者的回调函数
        }
      }
    }
  }
}

//定义一个installEvent函数，这个函数可以给所有的对象都动态安装发布—订阅功能：
let installEvent = function( obj ){
  for( let i in event ){
    obj[i] = event[i]
  }
}

//我们给售楼处对象salesOffices动态增加发布—订阅功能：
let salesOffices = {};
installEvent(salesOffices)

salesOffices.listen('小明88', fn1 = function( price ){ 
  console.log('价格= '+ price); //输出价格
})

salesOffices.listen('小红110', fn2 = function( price ){
  console.log('价格= '+ price); //输出价格
})

//例如小明突然不想买房子，为了避免继续接收到售楼处推送过来的短信，小明需要取消之前的订阅我们给event对象remove方法：
salesOffices.remove('小明88', fn1); //删除小明订阅该消息

salesOffices.trigger('小明88', 20000); //输出20000
salesOffices.trigger('小红110', 30000); //输出30000
```

以上代码来源是**javascript设计模式与开发实践**的`code`作为参考,值得我们学习的。